<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="estilos.css">
    <title>Space Invaders</title>
</head>
<body>
    <img src="fondo.jpg" id="fondo" alt="" hidden>
    <img src="nave.png" id="nave" alt="" hidden>
    <img src="nave_Enemiga.png" id="nave_Enemiga" alt="" hidden>
    <img src="nave_Enemiga_II.png" id="nave_Enemiga_II" alt="" hidden>
    <img src="nave_Enemiga_III.png" id="nave_Enemiga_III" alt="" hidden>

    <div class="main">
        <div class="cronometro" id="cronometro">
            
        </div>
        <div class="canvas">
            <canvas id="myCanvas" width="1300" height="800"></canvas>
        </div>
    </div>
    
    
    <script type="text/javascript">
        const myCanvas = document.getElementById("myCanvas");
        const ctx = myCanvas.getContext("2d");
        //DECLARACION DE CLASES 
        class nave_Enemiga{
            constructor(tipo, x, y, alto, ancho) {
                this.tipo = tipo;
                this.alto = alto;
                this.ancho = ancho;
                this.x = x;
                this.y = y;
            }

            Colision(objetivo){
                if(this.x < objetivo.x + objetivo.ancho &&  
                   this.x + this.ancho > objetivo.x &&  
                   this.y < objetivo.y + objetivo.alto &&   
                   this.y + this.alto > objetivo.y){ 
                    return true;    
                }
                return false;
            }
        };

        class misil_Jugador{
            constructor(color, x, y, alto, ancho) {
                this.alto = alto;
                this.ancho = ancho;
                this.color = color;
                this.x = x;
                this.y = y;
            }

            Colision(objetivo){
                if(this.x < objetivo.x + objetivo.ancho &&  
                   this.x + this.ancho > objetivo.x &&  
                   this.y < objetivo.y + objetivo.alto &&   
                   this.y + this.alto > objetivo.y){ 
                    return true;    
                }
                return false;
            }
        };

        class misil_Nave_Enemiga{
            constructor(color, x, y, alto, ancho, da単o) {
                this.alto = alto;
                this.ancho = ancho;
                this.color = color;
                this.x = x;
                this.y = y;
                this.da単o = da単o;
            }

            Colision(objetivo){
                if(this.x < objetivo.x + objetivo.ancho &&  
                   this.x + this.ancho > objetivo.x &&  
                   this.y < objetivo.y + objetivo.alto &&   
                   this.y + this.alto > objetivo.y){ 
                    return true;    
                }
                return false;
            }
        };

        class pared{
            constructor(color, x, y, alto, ancho, resistencia) {
                this.alto = alto;
                this.ancho = ancho;
                this.color = color;
                this.x = x;
                this.y = y;
                this.resistencia = resistencia;
            }

            Colision(objetivo){
                if(this.x < objetivo.x + objetivo.ancho &&  
                   this.x + this.ancho > objetivo.x &&  
                   this.y < objetivo.y + objetivo.alto &&   
                   this.y + this.alto > objetivo.y){ 
                    return true;    
                }
                return false;
            }
        };

        const img_nave = document.getElementById("nave");
        const img_fondo = document.getElementById("fondo");
        const img_nave_Enemiga = document.getElementById("nave_Enemiga");
        const img_nave_Enemiga_II = document.getElementById("nave_Enemiga_II");
        const img_nave_Enemiga_III = document.getElementById("nave_Enemiga_III");
        const misiles_Jugador = [];
        const misiles_Naves_Enemigas = [];
        const naves_Enemigas = [];
        const paredes = [];
        var direccion = '';
        var lado = "der"
        var jugador_x = 620;
        var cantidad_Naves_Enemigas = 33;
        var dificultad = 3;
        crear_Naves_Enemigas();
        programar_Paredes();

        document.addEventListener('keypress', function(e){
            switch(e.keyCode){
                case 97:
                    direccion = 'left';
                break;
                case 100:
                    direccion = 'right';
                break;
                case 32:
                    misiles_Jugador.push(new misil_Jugador("#37ff23",(jugador_x + 27), 650, 50, 7));
                break;
            } 
        });

        function update(){
            switch(direccion){
            case 'left':
                if(jugador_x >= 10){
                    jugador_x -= 5; 
                }
            break;
            case 'right':
                if(jugador_x <= 1230){
                    jugador_x += 5;
                }
            break;
            }
        }

        function pintar(){
            ctx.drawImage(img_fondo, 0, 0, 1300, 800);
            ctx.drawImage(img_nave, jugador_x, 700, 60, 60);

            //PINTAR NAVES ENEMIGAS
            naves_Enemigas.forEach(function (nave, i, array) {
                if(nave.tipo == 2){
                    ctx.drawImage(img_nave_Enemiga_II, nave.x, nave.y, nave.ancho, nave.alto)
                }else{
                    ctx.drawImage(img_nave_Enemiga, nave.x, nave.y, nave.ancho, nave.alto)
                }            
            });

            //PINTAR PAREDES
            paredes.forEach(function (pared, i, array) {
                ctx.fillStyle  = pared.color;
                ctx.fillRect(pared.x,pared.y,pared.ancho,pared.alto);            
            });

            movimiento_Naves_Enemigas()

            //PINTAR MISILES DE JUGADOR CADA VEZ QUE DISPARA
            misiles_Jugador.forEach(function (misil, i, array) {
                ctx.fillStyle  = misil.color;
                ctx.fillRect(misil.x,misil.y,misil.ancho,misil.alto);
                misil.y -= 7;
            });

            //PINTAR MISILES DE NAVE ENEMIGA CADA VEZ QUE DISPARA
            disparo_Nave_Enemiga();
            misiles_Naves_Enemigas.forEach(function (misil, i, array) {
                ctx.fillStyle  = misil.color;
                ctx.fillRect(misil.x,misil.y,misil.ancho,misil.alto);
                misil.y += 7;
            });

            //VERIFICAR IMPACTO O COLISION DE MISIL DE JUGADOR CON NAVES ENEMIGAS
            naves_Enemigas.forEach(function (nave, i, array){
                misiles_Jugador.forEach(function (misil, j, array){
                    if(misil.Colision(nave)){
                        naves_Enemigas.splice(i,1);
                        misiles_Jugador.splice(j,1);
                        if(naves_Enemigas.length == 0){
                            if(dificultad > 1){
                                dificultad -= 0.5;
                            }else{
                                dificultad -= 0.1;
                            }
                            crear_Naves_Enemigas();
                        }
                    }
                });
            });

            //VERIFICAR IMPACTO O COLISION DE MISIL CON PAREDES
            misiles_Jugador.forEach(function(misil, i, array){
                paredes.forEach(function(pared, j, array){
                    if(pared.Colision(misil)){
                        pared.resistencia--;
                        if(pared.resistencia == 0){
                            paredes.splice(j,1);
                        }
                        misiles_Jugador.splice(i,1);
                    }
                });
            });

            misiles_Naves_Enemigas.forEach(function(misil, i, array){
                paredes.forEach(function(pared, j, array){
                    if(pared.Colision(misil)){
                        pared.resistencia-= misil.da単o;
                        if(pared.resistencia == 0){
                            paredes.splice(j,1);
                        }
                        misiles_Naves_Enemigas.splice(i,1);
                    }
                });
            });

            naves_Enemigas.forEach(function(nave, i, array){
                paredes.forEach(function(pared, j, array){
                    if(pared.Colision(nave)){
                        paredes.splice(j,1);
                        naves_Enemigas.splice(i,1);
                        if(naves_Enemigas.length == 0){
                            if(dificultad > 1){
                                dificultad -= 0.5;
                            }else{
                                dificultad -= 0.1;
                            }
                            crear_Naves_Enemigas();
                        }
                    }
                });
            });

            update();
            requestAnimationFrame(pintar);
        }

        function crear_Naves_Enemigas(){
            //PINTAR PRIMERA FILA DE NAVES ENEMIGAS
            for (let index = 100; index < 1200; index+=100) { 
                naves_Enemigas.push(new nave_Enemiga(2, index,50,60,60));
            }

            //PINTAR SEGUNDA FILA DE NAVES ENEMIGAS
            for (let index = 100; index < 1200; index+=100) { 
                naves_Enemigas.push(new nave_Enemiga(1, index,170,60,60));
            }

            //PINTAR TERCERA FILA DE NAVES ENEMIGAS
            for (let index = 100; index < 1200; index+=100) { 
                naves_Enemigas.push(new nave_Enemiga(1, index,290,60,60));
            }
        }

        //CODIGO PARA MOVER NAVES ENEMIGAS
        function movimiento_Naves_Enemigas(){
            let borde_Derecho = false;
            let borde_Izquierdo = false;

            //VERIFICAR SI TOCA BORDE
            naves_Enemigas.forEach(function (nave, i, array){
                if(nave.x + nave.ancho >= myCanvas.width){
                    borde_Derecho = true;
                }else if(nave.x <= 0){
                    borde_Izquierdo = true;
                }
            });

            //MOVER NAVES
            if(lado == "der"){
                naves_Enemigas.forEach(function (nave, i, array){
                    nave.x += 3 / dificultad;
                });
            }else{
                naves_Enemigas.forEach(function (nave, i, array){
                    nave.x -= 3 / dificultad;
                });
            }

            //BAJAR NAVES
            if(borde_Derecho && lado == "der"){
                lado = "izq";
                naves_Enemigas.forEach(function (nave, i, array){
                    nave.y += 20;
                });
            }else if(borde_Izquierdo && lado == "izq"){
                lado = "der";
                naves_Enemigas.forEach(function (nave, i, array){
                    nave.y += 20;
                });
            }
        }

        //FUNCION PARA PROGRAMAR DISPAROS DE LAS NAVES ENEMIGAS
        let tiempo_Acumulado_Anterior = 0;
        function disparo_Nave_Enemiga(){
            let nave_Id = Math.floor(Math.random() * 32);

            if(naves_Enemigas[nave_Id] != null && ((tiempo_Acumulado / 1000) - tiempo_Acumulado_Anterior) >= dificultad){
                switch(naves_Enemigas[nave_Id].tipo){
                    case 1:
                        misiles_Naves_Enemigas.push(new misil_Nave_Enemiga(
                        "red",(naves_Enemigas[nave_Id].x + 27), naves_Enemigas[nave_Id].y,50,7,1));
                    break;
                    case 2:
                        misiles_Naves_Enemigas.push(new misil_Nave_Enemiga(
                        "red",(naves_Enemigas[nave_Id].x + 27), naves_Enemigas[nave_Id].y,50,7,2));
                    break;
                }
                misiles_Naves_Enemigas.push(new misil_Nave_Enemiga(
                "red",(naves_Enemigas[nave_Id].x + 27), naves_Enemigas[nave_Id].y,50,7,1));
                tiempo_Acumulado_Anterior = tiempo_Acumulado / 1000;
            }
        }

        //CODIGO PARA CREAR LAS PAREDES
        function programar_Paredes(){
            //PARED 1
            for (let index = 650; index > 550; index-=10) {
                paredes.push(new pared("green", 120, index, 10, 7, 2));
            }
            for (let index = 650; index > 550; index-=10) {
                paredes.push(new pared("green", 127, index, 10, 7, 2));
            }
            for (let index = 130; index < 230; index+=4) {
                paredes.push(new pared("green", index, 560,5, 5, 2));
            }
            for (let index = 130; index < 230; index+=4) {
                paredes.push(new pared("green", index, 564,5, 5, 2));
            }
            for (let index = 130; index < 230; index+=4) {
                paredes.push(new pared("green", index, 568,5, 5, 2));
            }
            for (let index = 130; index < 230; index+=4) {
                paredes.push(new pared("green", index, 572,5, 5, 2));
            }
            for (let index = 650; index > 550; index-=10) {
                paredes.push(new pared("green", 227, index, 10, 7, 2));
            }
            for (let index = 650; index > 550; index-=10) {
                paredes.push(new pared("green", 220, index, 10, 7, 2));
            }
            //PARED 2
            for (let index = 650; index > 550; index-=10) {
                paredes.push(new pared("green", 420, index, 10, 7, 2));
            }
            for (let index = 650; index > 550; index-=10) {
                paredes.push(new pared("green", 427, index, 10, 7, 2));
            }
            for (let index = 430; index < 530; index+=4) {
                paredes.push(new pared("green", index, 560,5, 5, 2));
            }
            for (let index = 430; index < 530; index+=4) {
                paredes.push(new pared("green", index, 564,5, 5, 2));
            }
            for (let index = 430; index < 530; index+=4) {
                paredes.push(new pared("green", index, 568,5, 5, 2));
            }
            for (let index = 430; index < 530; index+=4) {
                paredes.push(new pared("green", index, 572,5, 5, 2));
            }
            for (let index = 650; index > 550; index-=10) {
                paredes.push(new pared("green", 527, index, 10, 7, 2));
            }
            for (let index = 650; index > 550; index-=10) {
                paredes.push(new pared("green", 520, index, 10, 7, 2));
            }
            //PARED 3
            for (let index = 650; index > 550; index-=10) {
                paredes.push(new pared("green", 720, index, 10, 7, 2));
            }
            for (let index = 650; index > 550; index-=10) {
                paredes.push(new pared("green", 727, index, 10, 7, 2));
            }
            for (let index = 730; index < 830; index+=4) {
                paredes.push(new pared("green", index, 560,5, 5, 2));
            }
            for (let index = 730; index < 830; index+=4) {
                paredes.push(new pared("green", index, 564,5, 5, 2));
            }
            for (let index = 730; index < 830; index+=4) {
                paredes.push(new pared("green", index, 568,5, 5, 2));
            }
            for (let index = 730; index < 830; index+=4) {
                paredes.push(new pared("green", index, 572,5, 5, 2));
            }
            for (let index = 650; index > 550; index-=10) {
                paredes.push(new pared("green", 827, index, 10, 7, 2));
            }
            for (let index = 650; index > 550; index-=10) {
                paredes.push(new pared("green", 820, index, 10, 7, 2));
            }
            //PARED 4
            for (let index = 650; index > 550; index-=10) {
                paredes.push(new pared("green", 1020, index, 10, 7, 2));
            }
            for (let index = 650; index > 550; index-=10) {
                paredes.push(new pared("green", 1027, index, 10, 7, 2));
            }
            for (let index = 1030; index < 1130; index+=4) {
                paredes.push(new pared("green", index, 560,5, 5, 2));
            }
            for (let index = 1030; index < 1130; index+=4) {
                paredes.push(new pared("green", index, 564,5, 5, 2));
            }
            for (let index = 1030; index < 1130; index+=4) {
                paredes.push(new pared("green", index, 568,5, 5, 2));
            }
            for (let index = 1030; index < 1130; index+=4) {
                paredes.push(new pared("green", index, 572,5, 5, 2));
            }
            for (let index = 650; index > 550; index-=10) {
                paredes.push(new pared("green", 1127, index, 10, 7, 2));
            }
            for (let index = 650; index > 550; index-=10) {
                paredes.push(new pared("green", 1120, index, 10, 7, 2));
            }
        }

        //CODIGO PARA HACER EL CRONOMETRO
        let inicio = true;
        let tiempo_Referencia = Date.now();
        let tiempo_Acumulado = 0;
        setInterval(()=>{
            let tiempo = document.getElementById("cronometro");
            if(inicio){
                tiempo_Acumulado += Date.now() - tiempo_Referencia;
            }
            tiempo_Referencia = Date.now();
            tiempo.innerHTML = "Tiempo: " + formatoCronometro(tiempo_Acumulado);
        }, 1000/60);

        function formatoCronometro(milisegundos){
            let ms = milisegundos % 1000;
            let St = Math.floor(((milisegundos - ms) / 1000))
            let s = St % 60
            let m = Math.floor((St / 60) % 60)
            let h = Math.floor((St/60 / 60))
            Number.prototype.ceros = function(n){
                return (this + "").padStart(n,0)
            }
            return m.ceros(2) + ":" + s.ceros(2);
        }

        requestAnimationFrame(pintar);
        window.requestAnimationFrame = (function () {
        return window.requestAnimationFrame ||
        window.webkitRequestAnimationFrame ||
        window.mozRequestAnimationFrame ||
        function (callback) {
            window.setTimeout(callback, 17);
        };
        }());
    </script>
</body>
</html>