<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="estilos.css">
    <title>Space Invaders</title>
</head>
<body>
    <img src="fondo.jpg" id="fondo" alt="" hidden>
    <img src="nave.png" id="nave" alt="" hidden>
    <img src="nave_Enemiga.png" id="nave_Enemiga" alt="" hidden>
    <img src="nave_Enemiga_II.png" id="nave_Enemiga_II" alt="" hidden>
    <img src="nave_Enemiga_III.png" id="nave_Enemiga_III" alt="" hidden>

    <div class="main">
        <div class="cronometro" id="cronometro">
            
        </div>
        <div class="canvas">
            <canvas id="myCanvas" width="1300" height="800"></canvas>
        </div>
    </div>
    
    
    <script type="text/javascript">
        const myCanvas = document.getElementById("myCanvas");
        const ctx = myCanvas.getContext("2d");
        //DECLARACION DE CLASES 
        class nave_Enemiga{
            constructor(x, y, alto, ancho) {
                this.alto = alto;
                this.ancho = ancho;
                this.x = x;
                this.y = y;
            }

            Colision(objetivo){
                if(this.x < objetivo.x + objetivo.ancho &&  
                   this.x + this.ancho > objetivo.x &&  
                   this.y < objetivo.y + objetivo.alto &&   
                   this.y + this.alto > objetivo.y){ 
                    return true;    
                }
                return false;
            }
        };

        class misil_Jugador{
            constructor(color, x, y, alto, ancho) {
                this.alto = alto;
                this.ancho = ancho;
                this.color = color;
                this.x = x;
                this.y = y;
            }

            Colision(objetivo){
                if(this.x < objetivo.x + objetivo.ancho &&  
                   this.x + this.ancho > objetivo.x &&  
                   this.y < objetivo.y + objetivo.alto &&   
                   this.y + this.alto > objetivo.y){ 
                    return true;    
                }
                return false;
            }
        };

        class misil_Nave_Enemiga{
            constructor(color, x, y, alto, ancho) {
                this.alto = alto;
                this.ancho = ancho;
                this.color = color;
                this.x = x;
                this.y = y;
            }

            Colision(objetivo){
                if(this.x < objetivo.x + objetivo.ancho &&  
                   this.x + this.ancho > objetivo.x &&  
                   this.y < objetivo.y + objetivo.alto &&   
                   this.y + this.alto > objetivo.y){ 
                    return true;    
                }
                return false;
            }
        };

        const img_nave = document.getElementById("nave");
        const img_fondo = document.getElementById("fondo");
        const img_nave_Enemiga = document.getElementById("nave_Enemiga");
        const img_nave_Enemiga_II = document.getElementById("nave_Enemiga_II");
        const img_nave_Enemiga_III = document.getElementById("nave_Enemiga_III");
        const misiles_Jugador = [];
        const naves_Enemigas = [];
        var direccion = '';
        var jugador_x = 620;
        var cantidad_Naves_Enemigas = 23;
        pintar_Naves_Enemigas();

        document.addEventListener('keypress', function(e){
            switch(e.keyCode){
                case 97:
                    direccion = 'left';
                break;
                case 100:
                    direccion = 'right';
                break;
                case 32:
                    misiles_Jugador.push(new misil_Jugador("#37ff23",(jugador_x + 27), 610, 50, 7));
                break;
            } 
        });

        function update(){
            switch(direccion){
            case 'left':
                if(jugador_x >= 10){
                    jugador_x -= 5; 
                }
            break;
            case 'right':
                if(jugador_x <= 1230){
                    jugador_x += 5;
                }
            break;
            }
        }

        function pintar(){
            ctx.drawImage(img_fondo, 0, 0, 1300, 800);
            ctx.drawImage(img_nave, jugador_x, 670, 60, 60);

            //PINTAR NAVES ENEMIGAS
            naves_Enemigas.forEach(function (nave, i, array) {
                if(nave.y == 50){
                    ctx.drawImage(img_nave_Enemiga_II, nave.x, nave.y, nave.ancho, nave.alto)
                }else{
                    ctx.drawImage(img_nave_Enemiga, nave.x, nave.y, nave.ancho, nave.alto)
                }
                
            });

            //PINTAR MISILES DE JUGADOR CADA VEZ QUE DISPARA
            misiles_Jugador.forEach(function (misil, i, array) {
                ctx.fillStyle  = misil.color;
                ctx.fillRect(misil.x,misil.y,misil.ancho,misil.alto);
                misil.y -= 7;
            });

            //VERIFICAR IMPACTO O COLISION DE MISIL DE JUGADOR CON NAVES ENEMIGAS
            naves_Enemigas.forEach(function (nave, i, array){
                misiles_Jugador.forEach(function (misil, j, array){
                    if(misil.Colision(nave)){
                        naves_Enemigas.splice(i,1);
                        misiles_Jugador.splice(j,1);
                        if(naves_Enemigas.length == 0){
                            pintar_Naves_Enemigas();
                        }
                    }
                });
            });

            update();
            requestAnimationFrame(pintar);
        }

        function pintar_Naves_Enemigas(){
            //PINTAR PRIMERA FILA DE NAVES ENEMIGAS
            for (let index = 100; index < 1200; index+=100) { 
                naves_Enemigas.push(new nave_Enemiga(index,50,60,60));
            }

            //PINTAR SEGUNDA FILA DE NAVES ENEMIGAS
            for (let index = 100; index < 1200; index+=100) { 
                naves_Enemigas.push(new nave_Enemiga(index,170,60,60));
            }

            //PINTAR TERCERA FILA DE NAVES ENEMIGAS
            for (let index = 100; index < 1200; index+=100) { 
                naves_Enemigas.push(new nave_Enemiga(index,290,60,60));
            }
        }

        //CODIGO PARA HACER EL CRONOMETRO
        let inicio = true;
        let tiempo_Referencia = Date.now();
        let tiempo_Acumulado = 0;
        setInterval(()=>{
            let tiempo = document.getElementById("cronometro");
            if(inicio){
                tiempo_Acumulado = Date.now() - tiempo_Referencia;
                tiempo.innerHTML = "Tiempo: " + formatoCronometro(tiempo_Acumulado);
            }
        }, 1000/60);

        function formatoCronometro(milisegundos){
            let ms = milisegundos % 1000;
            let s = Math.floor(((milisegundos - ms) / 1000) % 60);
            let m = Math.floor((s / 60) % 60);
            Number.prototype.ceros = function(n){
                return (this + "").padStart(n,0)
            }
            return m.ceros(2) + ":" + s.ceros(2);
        }

        requestAnimationFrame(pintar);
        window.requestAnimationFrame = (function () {
        return window.requestAnimationFrame ||
        window.webkitRequestAnimationFrame ||
        window.mozRequestAnimationFrame ||
        function (callback) {
            window.setTimeout(callback, 17);
        };
        }());
    </script>
</body>
</html>